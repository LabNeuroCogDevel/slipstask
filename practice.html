<!DOCTYPE html>
<!-- 
This file for github pages
see https://labneurocogdevel.github.io/slipstask
-->
<html>
  <head>
    <meta charset="UTF-8">
    <title>Fabulious Fruits</title>
    <!-- all of this also in ./templates/exp.html -->
    <link rel="stylesheet" href="static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="static/js/jspsych/css/jspsych.css" type="text/css" />
    <link rel="stylesheet" href="static/css/style.css" type="text/css" />
    <link rel="stylesheet" href="static/css/task.css" type="text/css" />
    <script src="static/lib/jquery-3.4.1.min.js" type="text/javascript"> </script>
    <script src="static/lib/underscore-min.js" type="text/javascript"> </script>
    <script src="static/lib/backbone-min.js" type="text/javascript"> </script>
    <script src="static/lib/d3.v3.min.js" type="text/javascript"> </script>
    <script src="static/js/jspsych/jspsych.js" type="text/javascript"></script>
    <script src="static/js/jspsych/plugins/jspsych-instructions.js" type="text/javascript"></script>
    <script src="static/js/jspsych/plugins/jspsych-html-keyboard-response.js" type="text/javascript"></script>
    <script src="static/js/jspsych/plugins/jspsych-survey-text.js" type="text/javascript"></script>
    <script src="static/js/jspsych/plugins/jspsych-survey-multi-choice.js" type="text/javascript"></script>
    <script src="static/js/jspsych/plugins/jspsych-html-slider-response.js" type="text/javascript"></script>
    <script src="static/js/utils.js" type="text/javascript"> </script>
    <script src="static/js/instructions.js" type="text/javascript"> </script>
    <script src="static/js/task.js" type="text/javascript"> </script>
<style>
 #jsp { width: 49%;}
 #sidebar { transform: scale(.5); position: absolute; top:-100px;right:100px;width:40%; height:90%;}
 td {text-align:center;}
</style>

    <script type="text/javascript">
DEBUG=true;


var p_imgs = fruits(["peanut","avocado","onion","potato","mushroom","leafygreen","hotpepper","eggplant","corn","cucumber","carrot","broccoli"]);
// const practice_soa = soa_assign(1,6,1,1);
// const p_boxes = allBoxes(p_imgs, practice_soa);
/* hard code practice boxes */
const p_boxes = [
    mkBox(p_imgs['peanut'],p_imgs['avocado'], 'Left', [0]),
    mkBox(p_imgs['onion'],p_imgs['potato'], 'Left',[]),
    mkBox(p_imgs['mushroom'],p_imgs['leafygreen'],'Left', []),
    mkBox(p_imgs['hotpepper'],p_imgs['eggplant'], 'Right',[]),
    mkBox(p_imgs['corn'],p_imgs['cucumber'], 'Right',[]),
    mkBox(p_imgs['carrot'],p_imgs['broccoli'],'Right', [0]),
];


const prac = {
    // 1. Instructed Discrimination. (6 boxes * 2 reps)*8 blocks 
   'ID' : [mkBoxTrial(p_boxes[0], -1,'IDprac1'),
           mkIDFbk(p_imgs),
           mkBoxTrial(p_boxes[5], -1,'IDprac2'),
           mkIDFbk(p_imgs),
           mkBoxTrial(p_boxes[1], -1,'IDprac3'),
           mkIDFbk(p_imgs),
           mkBoxTrial(p_boxes[4], -1,'IDprac4'),
           mkIDFbk(p_imgs),
   ],
   // 2. OD
   'OD' : [mkODTrial(p_boxes[1].O, p_boxes[5].O), mkODTrial(p_boxes[4].O, p_boxes[1].O), mkScoreFbk(2)],
   // 3. SOA - slips of action 9 blocks w/ 12 trials each (2 outcomes per bloc), 108 trials total. (N.B. `6C2 == 15`)
   'SOA': mkSOAblocks(p_imgs, p_boxes, SO.Outcome,  1, 1),
   // 4. DD - devalued discrimination */
   'DD' : mkSOAblocks(p_imgs, p_boxes, SO.Stim,    1, 1)
};


function trials(timeline){
   jsPsych.init({
     timeline: timeline,
     display_element: jsp,
     preload_images: ['static/images/box_closed.png',
         'static/images/box_open_sm.gif',
         Object.values(p_imgs).map(f=>f.img)].flat(),
     on_finish: function() {
                    trials(timeline)}});
}

function gotoPhase(phase){
   const inst_str = phase!==null?INSTRUCTIONS_DATA[phase+"_wf"].join("<hr>"):"";
   $("#instructions").html(inst_str);
   trials(prac[phase]);
}

function togglesidebar(){
   $('#cheat_chart').fadeToggle(0);
   $('#instructions').fadeToggle(0);
}


function init(){
  $("#cheat_chart").html(cheat_chart(p_boxes));
  $("#instructions").hide();
  gotoPhase('ID');
}
    </script>

  </head>

  <body onload="init()">
     <div id="sidebar">
        <a href="#" onclick="togglesidebar()"> cheat table</a>  |
        <a href="#" onclick="togglesidebar()"> instructions</a> 
        <br>
       <div id="cheat_chart"> </div>
       <div id="instructions"> </div>
     </div>
     <div id="toc">
      1:       <a href="#" onclick="gotoPhase('ID')">ID</a>,
      2:       <a href="#" onclick="gotoPhase('OD')"> OD</a>,
      3&amp;4: <a href="#" onclick="gotoPhase('SOA')">SOA</a>
            or <a href="#" onclick="gotoPhase('DD')"> DD</a>.
      <a href="#" onclick="showInstructions()">clear</a>.
     </div>
    <div>
     <div id="jsp"> </div>
    </div>
  </body>
</html>

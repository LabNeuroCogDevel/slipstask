<!DOCTYPE html>
<!-- 
This file for github pages
see https://labneurocogdevel.github.io/slipstask
-->
<html>
  <head>
    <meta charset="UTF-8">
    <title>Fabulious Fruits</title>
    <!-- all of this also in ./templates/exp.html -->
    <link rel="stylesheet" href="static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="static/js/jspsych/css/jspsych.css" type="text/css" />
    <link rel="stylesheet" href="static/css/style.css" type="text/css" />
    <link rel="stylesheet" href="static/css/task.css" type="text/css" />
    <script src="static/lib/jquery-3.4.1.min.js" type="text/javascript"> </script>
    <script src="static/lib/underscore-min.js" type="text/javascript"> </script>
    <script src="static/lib/backbone-min.js" type="text/javascript"> </script>
    <script src="static/lib/d3.v3.min.js" type="text/javascript"> </script>
    <script src="static/js/jspsych/jspsych.js" type="text/javascript"></script>
    <script src="static/js/jspsych/plugins/jspsych-instructions.js" type="text/javascript"></script>
    <script src="static/js/jspsych/plugins/jspsych-html-keyboard-response.js" type="text/javascript"></script>
    <script src="static/js/jspsych/plugins/jspsych-survey-text.js" type="text/javascript"></script>
    <script src="static/js/jspsych/plugins/jspsych-survey-multi-choice.js" type="text/javascript"></script>
    <script src="static/js/utils.js" type="text/javascript"> </script>
    <script src="static/js/task.js" type="text/javascript"> </script>

    <script type="text/javascript">

var FRTS = fruits();
// 9 blocks of 6 boxes each repeated 3 times. 2 devalued per block
// devaule for on Slips Of Action and Discrimination Devaluation 
const soa_boxes = soa_assign(9, 6, 3, 2);

var boxes = [mkBox(FRTS['apple'],   FRTS['kiwi'],      "Left",  soa_boxes[0]),
	     mkBox(FRTS['grape'],   FRTS['lemon'],     "Right", soa_boxes[1]),
	     mkBox(FRTS['bananas'], FRTS['coconut'],   "Right", soa_boxes[2]),
	     mkBox(FRTS['melon'],   FRTS['cherries'],  "Left",  soa_boxes[3]),
	     mkBox(FRTS['orange'],  FRTS['pineapple'], "Left",  soa_boxes[4]),
	     mkBox(FRTS['pear'],    FRTS['strawberry'],"Right", soa_boxes[5])];

/* feedbacks - not random. don't care about what came before */
var fbk = mkIDFbk();

/* 1. Instructed Discrimination. (6 boxes * 2 reps)*8 blocks */
const IDidx = random_IDidx(boxes.length);
const allID = [].concat(IDidx.map( (i, ii) => [mkBoxTrial(boxes[i], -1, 'ID_' + Math.floor(ii/12) ), fbk])).flat()

/* 2. OD - outcome devaluation */
allOD = mkODblock(FRTS);

/* 3. SOA - slips of action
      9 blocks w/ 12 trials each (2 outcomes per bloc), 108 trials total. (N.B. `6C2 == 15`)
*/
allSOA = mkSOAblocks(FRTS, boxes, SO.Outcome,  9, 2);
/* 4. DD - devalued discrimination */
allDD  = mkSOAblocks(FRTS, boxes, SO.Stimulus, 9, 1);

const scoretl = mkScoreFbk(); // tl = timeline
IDTL   = allID.slice(0,4);
ODTL   = [allOD.slice(0,2), scoretl].flat();
SOATL  = [allSOA.slice(0,3), scoretl].flat();
DDTL  =  [allDD.slice(0,3), scoretl].flat();

fullTL = [allID, allOD, allSOA, allDD].flat()

function trials(timeline){
  jsPsych.init({timeline: timeline,
		display_element: jsp,
		on_finish: function() {
		    trials(timeline)}});
}

function showInstructions(inst){
   const inst_str = INSTRUCTIONS_DATA[inst];
   console.log(inst_str)
   var inst_t = mkInstruction(inst_str);
   trials([inst_t]);
}


function init(){ trials(fullTL); }
    </script>

  </head>

  <body onload="init()">
    <div> links:
      <a href="https://github.com/LabNeuroCogDevel/slipstask"> repo</a> |
      <a href="https://sliplncd.herokuapp.com/"> heroku (DNE!)</a>
    </div>
    <div> trials:
      <a href="#" onclick="trials(fullTL)"> fulltask </a> |
      <a href="#" onclick="trials(IDTL)"> ID</a> |
      <a href="#" onclick="trials(ODTL)"> OD</a> |
      <a href="#" onclick="trials(SOATL)"> SOA</a> |
      <a href="#" onclick="trials(DDTL)"> DD</a> |
    </div>
    <div> instructions:
      <a href="#" onclick="showInstructions('ID')"> ID</a> |
      <a href="#" onclick="showInstructions('OD')"> OD</a> |
      <a href="#" onclick="showInstructions('SOA')"> SOA</a> |
      <a href="#" onclick="showInstructions('DD')"> DD</a> |
       WF ver:
      <a href="#" onclick="showInstructions('ID_wf')"> ID</a> |
      <a href="#" onclick="showInstructions('OD_wf')"> OD</a> |
      <a href="#" onclick="showInstructions('SOA_wf')"> SOA</a> |
      <a href="#" onclick="showInstructions('DD_wf')"> DD</a> |
    </div>
    <br><br>
    <div>
      <div id="jsp"> </div>
    </div>
  </body>
</html>
